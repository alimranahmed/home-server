name: VPN

networks:
    shared_network:
        driver: bridge

services:
    vpn:
        image: qmcgaw/gluetun
        container_name: vpn
        restart: unless-stopped
        networks:
            - shared_network
        cap_add:
            - NET_ADMIN # This needed for vpn to modify network traffic
        devices:
            - /dev/net/tun
        volumes:
            - /home-server-data/GluetunVpn/config:/gluetun
        environment:
            - VPN_SERVICE_PROVIDER=private internet access
            - OPENVPN_USER=${OPENVPN_USER}
            - OPENVPN_PASSWORD=${OPENVPN_PASSWORD}
            - SERVER_REGIONS=${OPENVPN_REGIONS}
        ports:
            - "8080:8080"     # qBittorrent Web UI on port 8080
            - "6881:6881/tcp" # Torrent TCP port
            - "6881:6881/udp" # Torrent UDP port
            - "9696:9696"  # Prowlarr Web UI exposed on port 9696
            - "7878:7878"  # Radarr Web UI exposed on port 7878

    qbittorrent:
        image: qbittorrentofficial/qbittorrent-nox
        container_name: qbittorrent
        restart: unless-stopped
        network_mode: "service:vpn" # Route traffic through the VPN container
        depends_on:
            - vpn
        environment:
            - WEBUI_PORT=8080
        volumes:
            - /home-server-data/QBittorrent/config:/config
            - /home-server-data/downloads:/downloads

    prowlarr:
        image: lscr.io/linuxserver/prowlarr:latest
        container_name: prowlarr
        depends_on:
            - vpn # Ensure Prowlarr starts after VPN
        network_mode: "service:vpn" # Route traffic through the VPN container
        volumes:
            - /home-server-data/Prowlarr/config:/config
        restart: unless-stopped

    radarr:
        image: linuxserver/radarr
        container_name: radarr
        depends_on:
            - vpn # Ensure Radarr starts after VPN
        network_mode: "service:vpn" # Route traffic through the VPN container
        volumes:
            - /home-server-data/Radarr/config:/config
            - /home-server-data/downloads:/downloads  # Shared downloads folder with qBittorrent
            - /home-server-data/Contents:/media  # Shared media folder for movie storage(eg. Jellyfin)
        restart: unless-stopped